/* =========================================
    Module: Keyboard Emulator
========================================= */

:root {
    --kb-toolbar-bg: rgba(250, 250, 252, 0.92);
    --kb-toolbar-border: rgba(0, 0, 0, 0.12);

    --kb-btn-bg: rgba(0, 0, 0, 0.06);
    --kb-btn-border: rgba(0, 0, 0, 0.16);
    --kb-btn-text: rgba(0, 0, 0, 0.88);

    --kb-text-opacity: 0.92;

    --kb-sticky-bg: rgba(0, 106, 255, 0.14);
    --kb-sticky-border: rgba(0, 106, 255, 0.38);

    /* Layout / motion tokens (kept equivalent, just made explicit) */
    --kb-width: 100vw;

    --kb-outer-pad-y: 8px;
    --kb-outer-pad-x: 8px;

    --kb-backdrop-blur: 12px;

    --kb-z-index: 2147483647;

    --kb-key-h: 40px;
    --kb-key-w: 44px;

    --kb-btn-gap: 8px;
    --kb-row-gap: 2px;

    --kb-btn-pad-x: 12px;
    --kb-btn-inner-gap: 6px;

    --kb-font-size: calc(13px * var(--kc-text-scale));
    --kb-icon-size: calc(15px * var(--kc-text-scale));
    --kb-radius: 10px;

    --kb-show-opacity: 1;
    --kb-hide-opacity: 0;

    --kb-hide-translate-y: 110%;

    --kb-opacity-transition: 160ms ease;
    --kb-transform-transition: 200ms cubic-bezier(0.2, 0.8, 0.2, 1);

    --kb-active-scale: 0.98;

    --kb-stacked-gap: 2px;
    --kb-stacked-pad-y: 2px;

    --kb-stacked-text-scale: 0.92;
    --kb-arrow-scale: 1.1;

    /* Safe area */
    --kb-safe-area-bottom: env(safe-area-inset-bottom);
}

.dark-mode {
    --kb-toolbar-bg: rgba(20, 20, 22, 0.92);
    --kb-toolbar-border: rgba(255, 255, 255, 0.12);

    --kb-btn-bg: rgba(255, 255, 255, 0.1);
    --kb-btn-border: rgba(255, 255, 255, 0.18);
    --kb-btn-text: rgba(255, 255, 255, 0.92);

    --kb-text-opacity: 0.92;

    --kb-sticky-bg: rgba(99, 176, 255, 0.22);
    --kb-sticky-border: rgba(99, 176, 255, 0.45);
}

#keyboard-emu {
    position: fixed;
    left: 0;
    top: 0;

    width: var(--kb-width);
    box-sizing: border-box;

    padding:
        var(--outer-pad-y, var(--kb-outer-pad-y)) var(--outer-pad-x, var(--kb-outer-pad-x)) calc(var(--outer-pad-y, var(--kb-outer-pad-y)) + var(--kb-safe-area-bottom));

    display: flex;
    flex-direction: column;
    align-items: stretch;
    justify-content: center;

    background: var(--kb-toolbar-bg);

    backdrop-filter: blur(var(--kb-backdrop-blur));
    -webkit-backdrop-filter: blur(var(--kb-backdrop-blur));

    border-top: 1px solid var(--kb-toolbar-border);

    z-index: var(--toolbar-z, var(--kb-z-index));

    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;

    /* Internal sizing knobs */
    --key-h: var(--kb-key-h);
    --key-w: var(--kb-key-w);
    --btn-gap: var(--kb-btn-gap);

    --row-gap: var(--kb-row-gap);
    --pad-x: var(--kb-btn-pad-x);
    --inner-gap: var(--kb-btn-inner-gap);

    --font-size: var(--kb-font-size);
    --icon-size: var(--kb-icon-size);
    --radius: var(--kb-radius);

    opacity: var(--kb-show-opacity);
    transform: translate3d(0, 0, 0);

    transition:
        opacity var(--kb-opacity-transition),
        transform var(--kb-transform-transition);

    will-change: opacity, transform;
    gap: var(--row-gap);

    &.kb-hidden {
        opacity: var(--kb-hide-opacity);
        transform: translate3d(0, var(--kb-hide-translate-y), 0);
        pointer-events: none;
    }

    & .fn-grid-wrap {
        display: none;
        width: 100%;
        overflow: hidden;
    }

    &.fn-on .fn-grid-wrap {
        display: flex;
        justify-content: center;
    }

    & .fn-grid {
        display: grid;
        grid-auto-flow: column;
        grid-auto-columns: var(--key-w);
        grid-template-rows: var(--key-h);
        gap: var(--btn-gap);

        align-items: stretch;
        justify-content: start;

        transform-origin: center top;
        will-change: transform;
    }

    & .key-grid {
        display: grid;
        grid-template-columns: repeat(7, var(--key-w));
        grid-template-rows: repeat(2, var(--key-h));
        gap: var(--btn-gap);

        align-items: stretch;
        justify-content: center;
    }

    & button {
        appearance: none;

        border: 1px solid var(--kb-btn-border);
        background: var(--kb-btn-bg);
        color: var(--kb-btn-text);

        border-radius: var(--radius);

        height: 100%;
        width: 100%;
        min-width: 0;

        padding: 0 var(--pad-x);

        font-family:
            system-ui,
            -apple-system,
            BlinkMacSystemFont,
            "Segoe UI",
            sans-serif;

        font-weight: 600;
        font-size: var(--font-size);
        line-height: 1;

        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--inner-gap);

        white-space: nowrap;
        overflow: hidden;

        &:active {
            transform: scale(var(--kb-active-scale));
        }

        &.sticky-on {
            background: var(--kb-sticky-bg);
            border-color: var(--kb-sticky-border);
        }

        &.plain {
            padding: 0;
        }

        &.stacked {
            flex-direction: column;
            justify-content: center;
            align-items: center;

            gap: var(--kb-stacked-gap);
            padding-top: var(--kb-stacked-pad-y);
            padding-bottom: var(--kb-stacked-pad-y);

            & .key-text {
                font-size: calc(var(--font-size) * var(--kb-stacked-text-scale));
                line-height: 1;
            }
        }
    }

    & .key-icon {
        font-size: var(--icon-size);
        line-height: 1;
        flex: 0 0 auto;
    }

    & .key-text {
        opacity: var(--kb-text-opacity);
        flex: 0 1 auto;
    }

    & .arrow {
        font-size: calc(var(--font-size) * var(--kb-arrow-scale));
        padding: 0;
    }

    /* Key placement */
    & .esc-key {
        grid-column: 1;
        grid-row: 1;
    }

    & .ctrl-key {
        grid-column: 2;
        grid-row: 1;
    }

    & .alt-key {
        grid-column: 3;
        grid-row: 1;
    }

    & .meta-key {
        grid-column: 4;
        grid-row: 1;
    }

    & .up-key {
        grid-column: 5;
        grid-row: 1;
    }

    & .return-key {
        grid-column: 6 / span 2;
        grid-row: 1;
    }

    & .shift-key {
        grid-column: 1 / span 2;
        grid-row: 2;
    }

    & .tab-key {
        grid-column: 3;
        grid-row: 2;
    }

    & .left-key {
        grid-column: 4;
        grid-row: 2;
    }

    & .down-key {
        grid-column: 5;
        grid-row: 2;
    }

    & .right-key {
        grid-column: 6;
        grid-row: 2;
    }

    & .fn-key {
        grid-column: 7;
        grid-row: 2;
    }
}