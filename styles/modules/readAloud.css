/* =========================================
    Module: Read Aloud Menu
========================================= */

:root {
    --read-aloud-menu-z-index: 2000;
    --read-aloud-close-z-index: 3000;

    --read-aloud-menu-radius: 15px;
    --read-aloud-menu-border-width: 1.5px;

    --read-aloud-menu-padding-top: 18px;
    --read-aloud-menu-padding-inline: 22px;
    --read-aloud-menu-padding-bottom: 14px;

    --read-aloud-menu-bg-alpha: 0.8;

    --read-aloud-menu-opacity-dragging: 0.92;

    --read-aloud-menu-drag-shadow: 0 6px 22px rgba(0, 0, 0, 0.25);

    --read-aloud-menu-transition-bg: 0.25s;
    --read-aloud-menu-transition-shadow: 0.25s;
    --read-aloud-menu-transition-color: 0.25s;
    --read-aloud-menu-transition-opacity: 0.2s;
    --read-aloud-menu-transition-pos: 0.2s;

    --read-aloud-jump-gap: 8px;
    --read-aloud-jump-margin-top: 10px;

    --read-aloud-jump-input-width: 6ch;

    --read-aloud-field-padding-block: 8px;
    --read-aloud-field-padding-inline: 12px;

    --read-aloud-jump-input-padding-block: 8px;
    --read-aloud-jump-input-padding-inline: 10px;

    --read-aloud-field-radius: 6px;
    --read-aloud-field-font-size: 1em;
    --read-aloud-field-border-width: 1px;

    --read-aloud-fields-gap: 4px;
    --read-aloud-fields-margin-bottom: 10px;

    --read-aloud-header-gap: 10px;
    --read-aloud-header-font-size: 1.07em;
    --read-aloud-header-padding-bottom: 6px;
    --read-aloud-header-margin-bottom: 12px;
    --read-aloud-header-border-width: 1px;

    --read-aloud-actions-gap: 7px;
    --read-aloud-actions-margin-top: 6px;

    --read-aloud-status-font-size: 0.98em;
    --read-aloud-status-margin-left: 12px;
    --read-aloud-status-min-width: 50px;

    --read-aloud-apikey-min-width: 220px;
    --read-aloud-apikey-padding-right: 44px;

    --read-aloud-eye-right: 10px;
    --read-aloud-eye-size: 28px;
    --read-aloud-eye-radius: 7px;
    --read-aloud-eye-icon-size: 18px;
    --read-aloud-eye-opacity: 0.78;
    --read-aloud-eye-hover-scale: 1.08;

    --read-aloud-eye-transition-bg: 0.2s;
    --read-aloud-eye-transition-transform: 0.18s;
    --read-aloud-eye-transition-opacity: 0.18s;

    --read-aloud-input-focus-transition: 0.2s;

    --read-aloud-close-top: 12px;
    --read-aloud-close-right: 30px;
    --read-aloud-close-font-size: 1.1em;
    --read-aloud-close-hover-scale: 1.2;
    --read-aloud-close-hover-transition: 0.2s ease;

    --read-aloud-button-min-width: 28px;
    --read-aloud-button-max-width: 48px;
    --read-aloud-button-padding-inline: 4px;
    --read-aloud-button-margin-inline: 2px;

    --read-aloud-button-radius: 7px;
    --read-aloud-button-font-size: clamp(1em, 4vw, 1.5em);
    --read-aloud-button-font-weight: 500;

    --read-aloud-button-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);

    --read-aloud-button-hover-scale: 1.08;
    --read-aloud-button-transition-bg: 0.2s;
    --read-aloud-button-transition-transform: 0.18s;

    --read-aloud-highlight-bg: #b388ff;
    --read-aloud-highlight-bg-dark: #e1bfff;

    --read-aloud-highlight-transition:
        background 0.4s cubic-bezier(0.4, 0, 0.2, 1),
        color 2s ease-in-out,
        opacity 0.4s;

    --read-aloud-fadeout-transition: opacity 0.6s;
}

/* =========================================
    Menu container
========================================= */

#read-aloud-menu {
    position: fixed;
    top: 0;
    left: 50%;

    transform: translateX(-50%);

    width: auto;
    max-width: 100vw;
    max-height: 100vh;

    overflow-x: auto;

    z-index: var(--read-aloud-menu-z-index);

    display: none;
    flex-direction: column;
    align-items: stretch;

    background: rgba(var(--frame-bg-colour-rgb), var(--read-aloud-menu-bg-alpha));
    color: var(--body-text-colour);

    border-radius: var(--read-aloud-menu-radius);
    box-shadow: var(--frame-box-shadow);

    border: var(--read-aloud-menu-border-width) solid var(--frame-border-light);

    padding:
        var(--read-aloud-menu-padding-top) var(--read-aloud-menu-padding-inline) var(--read-aloud-menu-padding-bottom);

    box-sizing: border-box;

    user-select: none;

    cursor: grab;

    transition:
        box-shadow var(--read-aloud-menu-transition-shadow),
        background var(--read-aloud-menu-transition-bg),
        color var(--read-aloud-menu-transition-color),
        opacity var(--read-aloud-menu-transition-opacity),
        left var(--read-aloud-menu-transition-pos),
        top var(--read-aloud-menu-transition-pos);

    &.dragging {
        opacity: var(--read-aloud-menu-opacity-dragging);
        cursor: grabbing;

        box-shadow:
            var(--read-aloud-menu-drag-shadow),
            var(--frame-box-shadow);
    }

    .read-aloud-header {
        display: flex;
        align-items: center;
        gap: var(--read-aloud-header-gap);

        font-weight: 700;
        font-size: var(--read-aloud-header-font-size);

        padding-bottom: var(--read-aloud-header-padding-bottom);
        margin-bottom: var(--read-aloud-header-margin-bottom);

        border-bottom: var(--read-aloud-header-border-width) solid var(--nav-border-colour);

        cursor: grab;
        user-select: none;
    }

    .read-aloud-controls {
        display: inline-flex;
        flex-direction: column;
        align-items: stretch;

        width: auto;
        gap: 0;
    }

    .read-aloud-fields,
    .read-aloud-buttons {
        display: flex;
        gap: var(--read-aloud-fields-gap);
        flex-wrap: wrap;

        width: 100%;

        align-items: center;
        justify-content: center;
    }

    .read-aloud-fields {
        margin-bottom: var(--read-aloud-fields-margin-bottom);
    }

    .read-aloud-jump {
        display: flex;
        gap: var(--read-aloud-jump-gap);
        flex-wrap: wrap;

        align-items: center;
        justify-content: center;

        width: 100%;
        margin-top: var(--read-aloud-jump-margin-top);
    }

    .read-aloud-jump-input {
        flex: 0 0 auto;
        width: var(--read-aloud-jump-input-width);

        text-align: center;

        padding: var(--read-aloud-jump-input-padding-block) var(--read-aloud-jump-input-padding-inline);
        border-radius: var(--read-aloud-field-radius);

        background: var(--chat-input-bg-colour);
        color: var(--chat-input-text-colour);

        border: var(--read-aloud-field-border-width) solid var(--chat-input-border-colour);

        box-sizing: border-box;

        appearance: textfield;

        &::-webkit-outer-spin-button,
        &::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    }

    input,
    select {
        flex: 1 1 0;
        width: 0;

        background: var(--chat-input-bg-colour);
        color: var(--chat-input-text-colour);

        border: var(--read-aloud-field-border-width) solid var(--chat-input-border-colour);
        border-radius: var(--read-aloud-field-radius);

        padding: var(--read-aloud-field-padding-block) var(--read-aloud-field-padding-inline);
        font-size: var(--read-aloud-field-font-size);

        outline: none;

        box-sizing: border-box;

        transition: border-color var(--read-aloud-input-focus-transition);

        &:focus {
            border-color: var(--menu-button-hover-bg-colour);
        }
    }

    .read-aloud-apikey-wrap {
        position: relative;

        display: flex;
        align-items: center;

        flex: 1 1 0;
        width: 0;

        min-width: var(--read-aloud-apikey-min-width);

        >input#read-aloud-apikey {
            flex: 1 1 auto;
            width: 100%;
            padding-right: var(--read-aloud-apikey-padding-right);
        }

        &:focus-within>input#read-aloud-apikey {
            border-color: var(--menu-button-hover-bg-colour);
        }
    }

    .read-aloud-apikey-eye {
        position: absolute;
        right: var(--read-aloud-eye-right);
        top: 50%;

        transform: translateY(-50%);

        width: var(--read-aloud-eye-size);
        height: var(--read-aloud-eye-size);

        display: inline-flex;
        align-items: center;
        justify-content: center;

        cursor: pointer;

        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;

        color: var(--body-text-colour);

        border-radius: var(--read-aloud-eye-radius);
        background: transparent;

        transition:
            background var(--read-aloud-eye-transition-bg),
            transform var(--read-aloud-eye-transition-transform),
            opacity var(--read-aloud-eye-transition-opacity);

        opacity: var(--read-aloud-eye-opacity);

        svg,
        img {
            width: var(--read-aloud-eye-icon-size);
            height: var(--read-aloud-eye-icon-size);

            display: block;
            pointer-events: none;
        }

        &:hover {
            background: var(--menu-button-hover-bg-colour);
            transform: translateY(-50%) scale(var(--read-aloud-eye-hover-scale));
            opacity: 1;
        }
    }

    /* Buttons (kept equivalent, including existing !important usage) */
    button {
        flex: 0 0 auto;

        width: auto;
        min-width: var(--read-aloud-button-min-width);
        max-width: var(--read-aloud-button-max-width);

        box-sizing: border-box;

        padding: 0 var(--read-aloud-button-padding-inline);
        margin: 0 var(--read-aloud-button-margin-inline);

        background: none !important;
        color: var(--menu-button-text-colour);

        border: none !important;
        border-radius: var(--read-aloud-button-radius);

        font-size: var(--read-aloud-button-font-size);
        font-weight: var(--read-aloud-button-font-weight);

        line-height: 1;

        cursor: pointer;
        user-select: none;

        transition:
            background var(--read-aloud-button-transition-bg),
            transform var(--read-aloud-button-transition-transform);

        outline: none !important;

        box-shadow: var(--read-aloud-button-shadow);

        &:hover {
            background: var(--menu-button-hover-bg-colour);
            transform: scale(var(--read-aloud-button-hover-scale));
        }

        &:active,
        &:focus {
            background: none !important;
            border: none !important;
            outline: none !important;
        }

        &.read-aloud-apikey-eye {
            background: rgba(var(--frame-bg-colour-rgb), 0.18) !important;
            padding: 0 !important;
            margin: 0 !important;

            &:hover,
            &:focus-visible {
                background: var(--menu-button-hover-bg-colour) !important;
                transform: translateY(-50%) scale(var(--read-aloud-eye-hover-scale)) !important;
                opacity: 1;
            }

            &:active {
                transform: translateY(-50%) scale(0.98) !important;
            }
        }
    }

    #read-aloud-status {
        flex: 1;

        font-size: var(--read-aloud-status-font-size);
        margin-left: var(--read-aloud-status-margin-left);

        color: var(--header-text-colour);

        min-width: var(--read-aloud-status-min-width);
    }

    .read-aloud-actions {
        display: flex;
        align-items: center;

        gap: var(--read-aloud-actions-gap);
        margin-top: var(--read-aloud-actions-margin-top);
    }

    a {
        color: var(--menu-button-text-colour);
        text-decoration: underline;

        transition: color 0.2s;

        &:hover,
        &:focus {
            color: var(--banner-blue);
            text-decoration: underline;
        }
    }
}

/* Close button (kept unscoped in case it ever lives outside the menu node) */
.read-aloud-close-button {
    position: absolute;
    top: var(--read-aloud-close-top);
    right: var(--read-aloud-close-right);

    align-self: flex-end;

    font-size: var(--read-aloud-close-font-size);

    cursor: pointer;
    user-select: none;

    transition: transform var(--read-aloud-close-hover-transition);

    z-index: var(--read-aloud-close-z-index);

    &:hover {
        transform: scale(var(--read-aloud-close-hover-scale));
    }
}

/* =========================================
    Highlighted text (reader bookmarks)
========================================= */

.reader-bookmark {
    &.read-aloud-active {
        background: var(--read-aloud-highlight-bg) !important;
        transition: var(--read-aloud-highlight-transition);
        opacity: 1 !important;

        :is(.reader-paragraph,
            .reader-title,
            .reader-subtitle,
            .reader-quote) {
            color: var(--body-text-colour-light) !important;
        }

        :is(p, h1, h2, blockquote) {
            color: var(--body-text-colour-light) !important;
        }
    }

    &.read-aloud-fadeout {
        opacity: 0 !important;
        transition: var(--read-aloud-fadeout-transition);
    }
}

/* Dark mode highlight variants (kept compatible with existing class patterns) */
:is(body.dark-mode, .dark-mode, body.dark, .dark) {
    .reader-bookmark {
        &.read-aloud-active {
            background: var(--read-aloud-highlight-bg-dark) !important;
        }

        &.read-aloud-fadeout {
            opacity: 0 !important;
        }
    }
}